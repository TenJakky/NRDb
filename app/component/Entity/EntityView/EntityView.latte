{if isset($data->poster_file)}
    <div id="image">
        <img src="{php getcwd().$data->poster_file}"/>
    </div>
{/if}

<h2>{$ratingModel->getRating($data->id)|number: 2}</h2>
{if $presenter->name == 'Series'}
    <h3>Average rating from seasons: {$ratingModel->getRatingFromSeasons($data->id)|number:2}</h3>
{/if}
<h3>Men's rating: {$ratingModel->getMenRating($data->id)|number: 2}</h3>
<h3>Women's rating: {$ratingModel->getWomenRating($data->id)|number: 2}</h3>

{var $rating => $ratingModel->getUserRating($data->id, $user->getId())}
{if $rating}
    <h3>My rating:
        {$rating->rating}
    </h3>
{/if}

<section>
    <ul class="inline-buttons">
        <li>
            <a href="{plink "{$presenter->name}:edit" $data->id}">Edit details</a>
        </li>
        <li>
            {if $rating}
                <a href="{plink "{$presenter->name}:editRating" $rating->id}">Edit rating</a>
            {else}
                <a href="{plink "{$presenter->name}:rate" $data->id}">Rate</a>
            {/if}
        </li>
    </ul>
</section>
<section>
    <table class="list">
        {if isset($data->english_title)}
            <tr>
                <th>English title</th>
                <td>{$data->english_title}</td>
            </tr>
        {/if}
        {if isset($data->czech_title)}
            <tr>
                <th>Czech title</th>
                <td>{$data->czech_title}</td>
            </tr>
        {/if}
        {if $presenter->name === 'Series'}
            <tr>
                <th>Status</th>
                <td>{$data->active ? 'Running' : 'Finished'}</td>
            </tr>
            {var range = $data->related('ent_season.series_id')->select('MIN(year) AS min, MAX(year) AS max')->fetch()}
            {if $range}
                <tr>
                    <th>Year</th>
                    <td>{$range->min} - {$data->active ? 'present' : $range->max}</td>
                </tr>
            {/if}
        {else}
            <tr>
                <th>Year</th>
                <td>{$data->year}</td>
            </tr>
        {/if}
        <tr>
            <th>Description</th>
            <td>{$data->description}</td>
        </tr>
        {switch $presenter->name}
            {case 'Book'}
                <tr>
                    <th>Author</th>
                    <td>
                        {artistList $data->related('jun_book2author.book_id')}
                    </td>
                </tr>
            {case 'Series'}
                <tr>
                    <th>Director</th>
                    <td>
                        {artistList $entityModel->getDirectors($data->id)}
                    </td>
                </tr>
                <tr>
                    <th>Cast</th>
                    <td>
                        {artistList $entityModel->getActors($data->id)}
                    </td>
                </tr>
            {case 'Movie'}
                <tr>
                    <th>Director</th>
                    <td>
                        {artistList $data->related('jun_movie2director.movie_id')}
                    </td>
                </tr>
                <tr>
                    <th>Cast</th>
                    <td>
                        {artistList $data->related('jun_movie2actor.movie_id')}
                    </td>
                </tr>
            {case 'Music'}
                <tr>
                    <th>Interpret</th>
                    <td>
                        {artistList $data->related('jun_music2interpret.music_id')}
                    </td>
                </tr>
        {/switch}
    </table>
</section>
{if $presenter->name === 'Series'}
    <section>
        <h2>Season List</h2>
        <ul class="inline-buttons">
            <li>
                <a href="{plink "Season:add" $data->id}">Add season</a>
            </li>
            <li>
                <a href="{plink "Season:rate" $data->id}">Add rating</a>
            </li>
        </ul>
        {control seasonList $data->id}
    </section>
{/if}
<section>
    <h2>User rating</h2>
    {control "{$presenter->name}RatingList" $data->id}
</section>
